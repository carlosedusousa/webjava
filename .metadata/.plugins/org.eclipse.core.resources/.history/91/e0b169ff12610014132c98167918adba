package modelos;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;
import javax.persistence.TypedQuery;

import org.junit.Assert;
import org.junit.BeforeClass;
import org.junit.Test;

import estudos.Usuario;

public class UsuarioTest {
	
	// O EntityManager � repons�vel por alterar os estados
	private static EntityManager em;  

	@BeforeClass
	public static void startEntityManager() throws Exception {
		// classe EntityManagerFactory, respons�vel por carregar as configura��es da unidade
		// de persist�ncia para dentro do EntityManager
		EntityManagerFactory emf = Persistence
				.createEntityManagerFactory("estudos");
		em = emf.createEntityManager();
		
		// Cria��o de um objeto como se faz normalmente em Java
		Usuario usuario = new Usuario();
		usuario.setNome("Nassor Paulino da Silva");
		usuario.setEmail("carlos@email,com");
		
		// In�cio dos trabalhos da JPA 
		em.getTransaction().begin();
		
		// Persiste, o objeto funcin�rio
		em.persist(usuario);
		
		// Commit de todas as opera��es efetuadas do begin() at� este ponto 
		em.getTransaction().commit();
	}
	
	@Test
	public void FindByIdTest() {
		Usuario u = em.find(Usuario.class, 1);
		assertNassor(u);
	}

	@Test
	public void FindByNomeTest() {
		TypedQuery<Usuario> query = 
				em.createQuery("select u from Usuario u where u.nome = :nome", 
						Usuario.class);
		query.setParameter("nome", "Nassor Paulino da Silva");
		Usuario u = query.getSingleResult();
		Assert.assertEquals("Nassor Paulino da Silva", u);
	}
	
//	@Test
//	public void FindByNascimentoTest() {
//		TypedQuery<Usuario> query = 
//				em.createQuery("select u from Usuario u where u.nascimento = :data",
//						Usuario.class);
//		query.setParameter("data", LocalDate.of(2014, 7, 3));
//		Usuario u = (Usuario) query.getSingleResult();
//		assertNassor(u);
//	}
	
	private void assertNassor(Usuario u) {
		Assert.assertEquals("Nassor Paulino da Silva", u.getNome());

	}
}
